# "Счета и деньги" - проект, реализованный на Scala

## Требования

### Функциональные требования

#### Основные

- состоит из счетов пользователей (деньги = целое число)
- пользователи могут пополнять счёт
- пользователи могут снимать со счёта
- пользователи могут переводить деньги между счетами

#### Дополнительные

- у переводов может быть указана категория перевода
- в зависимости от категории может начисляться различный кэшбэк

### Технические требования

- Scala
- PostgreSQL
- Docker
- приложение должно разворачиваться одной командой
- интерфейс взаимодействия с пользователем - REST API ([Akka HTTP](https://doc.akka.io/))
- сдача проекта как репозитория на GitHub

### Сущности (таблицы в БД)

- Счёт
- Категория
- ???

---

## Разработка

### Перед началом работы

- В корне проекта необходимо создать файл `.env` по формату `.env.example` и заполнить переменные окружения

### Необходимые команды

- `sbt new scala/scala-seed.g8` - создание нового проекта
- `sbt run` - запуск проекта

### Сценарий с кэшбеком

1. Создание счетов пользователей (при создании указывается категория бизнеса, на который определяется процент кэшбека)
   1. [Пользователь 1, счёт 1] **Клиент 1** (пользовательский фронт) -> **Сервер 1** `POST http://localhost:8001/accounts`
   2. [Пользователь 1, счёт 2] **Клиент 1** (пользовательский фронт) -> **Сервер 1** `POST http://localhost:8001/accounts`
   3. [Пользователь 2, счёт 1] **Клиент 1** (пользовательский фронт) -> **Сервер 1** `POST http://localhost:8001/accounts`
2. Пополнение счета пользователем 1
   1. **Клиент 2** (банкомат) -> **Сервер 1** `POST http://localhost:8001/cash`
3. Перевод пользователя 1 между своими счетами (кэшбек не начисляется)
   1. **Клиент 1** (пользовательский фронт) -> **Сервер 1** `POST http://localhost:8001/transfer/by_account_id`
4. Перевод между счетами двух разных пользователей (кэшбек накапливается)
   1. **Клиент 1** (пользовательский фронт) -> **Сервер 1** `POST http://localhost:8001/transfer/by_account_id`
   2. **Сервер 1** -> **Сервер 2** `POST http://localhost:8002/cashbacks` [создаётся запись о кэшбеке с учётом категории перевода, прикреплённой к принимающему средства счёту, отметкой "Не выплачен" и ID пользователя]
5. Списание накопленного кэшбека
   1. **Клиент 3** (периодическая задача, например, раз в месяц) -> **Сервер 2** `POST http://localhost:8002/cashbacks_pay` (запрос по ID пользователя)
   2. **Сервер 2** -> **Сервер 1** `POST http://localhost:8001/accrual_cashback` (учитывается сценарий, когда кэшбек меньше одного рубля от одного перевода, но к концу он может накопиться - при вычислении сумма группируется по проценту; начисление происходит по ID пользователя)
